# axiosæºç è§£è¯»-è¯·æ±‚å‰çš„å‡†å¤‡

## å‰è¨€

ä¸ºä»€ä¹ˆä¼šæƒ³å»è¯»æºç ?

èµ·å› è¿˜æ˜¯å†™å°ç¨‹åºé¡¹ç›®çš„æ—¶å€™ï¼Œåœ¨å›è°ƒé‡Œé¢æ€»æ˜¯å†™å¾ˆå¤šç›¸åŒçš„åˆ¤æ–­ï¼Œå¤§å¤§é™ä½äº†æˆ‘çš„ä»£ç ä½“éªŒæ„Ÿ[ğŸ¤·](https://emojipedia.org/shrug/)[ğŸ¤·](https://emojipedia.org/shrug/)[ğŸ¤·](https://emojipedia.org/shrug/)

`axios`è‡ªå¸¦æ‹¦æˆªå™¨ï¼Œç­‰ç­‰å¾ˆå¤šæœ‰ç”¨çš„æ–¹æ³•ï¼Œä¸€ç›´å¬é—»axioså®ç°å¾ˆå·§å¦™ï¼Œè™½ç„¶ç½‘ç»œä¸Šå·²ç»æœ‰å¾ˆå¯¹å¤§ä½¬çš„è§£è¯»è¿‡axiosï¼Œçœ‹æ–‡ç« ä¸å¤Ÿå°½å…´ï¼Œåªæœ‰äº²è‡ªæ¢ç©¶`axios`çš„å†…éƒ¨å®ç°ğŸ’ª

## ä»å…¥å£å¼€å§‹

ä¸‹è½½äº†axiosçš„æºç 

````
git clone https://github.com/axios/axios.git
````

å°±åœ¨æˆ‘æƒ³è¿™ä¸ªæºæ–‡ä»¶æ€ä¹ˆè¿è¡Œçš„æ—¶å€™ï¼Œæˆ‘å‘ç°åœ¨æ–‡ä»¶å¤¹é‡Œé¢ä¼¼ä¹æœ‰ç¤ºä¾‹ä»£ç `sandbox`é‡Œé¢æœ‰ç¤ºä¾‹ä»£ç 

è¿è¡Œåå‘ç°ï¼Œè¿™ä¸ªæ˜¯æ‰“åŒ…è¿‡çš„ä»£ç (é™·å…¥æ²‰æ€.....)

å› ä¸ºæµè§ˆå™¨ä¸è¯†åˆ«`require()` æ­¤ç±»çš„è¯­æ³•ï¼Œæ‰€ä»¥ç›´æ¥åº”ç”¨æºç ä¼šæŠ¥é”™

äºæ˜¯

#### æ­å»ºä¸€ä¸ªæŸ¥çœ‹axiosæºç çš„ç¯å¢ƒ

> ä¹Ÿå°±æ˜¯æ”¯æŒes6çš„webpacké…ç½®(æ‰“åŒ…å·¥å…·éƒ½å¯ä»¥ï¼Œæˆ‘å¯¹webpackæ¯”è¾ƒç†Ÿæ‚‰)

è¿™é‡Œè§£å†³çš„å°±æ˜¯æµè§ˆå™¨ä¸è®¤è¯†**require**çš„é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨`webpack`ï¼Œæ¥æ­å»ºä¸€ä¸ªæ”¯æŒ`es6`çš„å¼€å‘ç¯å¢ƒï¼Œ(è¿˜æ”¯æŒçƒ­åŠ è½½ï¼Œç¾æ»‹æ»‹~~~)

- å¯¹æ­å»ºæ¯«æ— å‹åŠ›çš„è¯·ç›´æ¥è·³è¿‡
- æƒ³æ­å»ºç¯å¢ƒçš„è¯·çœ‹è¿™é‡Œ[æ­å»ºes6è°ƒè¯•ç¯å¢ƒ](https://github.com/vkcyan/text/blob/master/JavaScript/webpack%E6%90%AD%E5%BB%BAes6%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83.md)



## ç›®å½•ç»“æ„

> è¿™é‡Œæˆ‘å¼•ç”¨è‡ªçŸ¥ä¹[æ·±å…¥æµ…å‡º axios æºç ](https://zhuanlan.zhihu.com/p/37962469)ï¼Œç›®å½•ç»“æ„å†™çš„æ¸…æ¥šæ˜äº†ï¼Œå‰äººæ ½æ ‘åäººä¹˜å‡‰ï¼Œæˆ‘ä¾¿ç›´æ¥å¼•ç”¨äº†

```text
â”œâ”€â”€ /lib/                      # é¡¹ç›®æºç ç›®
â”‚ â”œâ”€â”€ /adapters/               # å®šä¹‰å‘é€è¯·æ±‚çš„é€‚é…å™¨
â”‚ â”‚ â”œâ”€â”€ http.js                # nodeç¯å¢ƒhttpå¯¹è±¡
â”‚ â”‚ â””â”€â”€ xhr.js                 # æµè§ˆå™¨ç¯å¢ƒXMLå¯¹è±¡
â”‚ â”œâ”€â”€ /cancel/                 # å®šä¹‰å–æ¶ˆåŠŸèƒ½
â”‚ â”œâ”€â”€ /helpers/                # ä¸€äº›è¾…åŠ©æ–¹æ³•
â”‚ â”œâ”€â”€ /core/                   # ä¸€äº›æ ¸å¿ƒåŠŸèƒ½
â”‚ â”‚ â”œâ”€â”€ Axios.js               # axioså®ä¾‹æ„é€ å‡½æ•°
â”‚ â”‚ â”œâ”€â”€ createError.js         # æŠ›å‡ºé”™è¯¯
â”‚ â”‚ â”œâ”€â”€ dispatchRequest.js     # ç”¨æ¥è°ƒç”¨httpè¯·æ±‚é€‚é…å™¨æ–¹æ³•å‘é€è¯·æ±‚
â”‚ â”‚ â”œâ”€â”€ InterceptorManager.js  # æ‹¦æˆªå™¨ç®¡ç†å™¨
â”‚ â”‚ â”œâ”€â”€ mergeConfig.js         # åˆå¹¶å‚æ•°
â”‚ â”‚ â”œâ”€â”€ settle.js              # æ ¹æ®httpå“åº”çŠ¶æ€ï¼Œæ”¹å˜Promiseçš„çŠ¶æ€
â”‚ â”‚ â””â”€â”€ transformData.js       # æ”¹å˜æ•°æ®æ ¼å¼
â”‚ â”œâ”€â”€ axios.js                 # å…¥å£ï¼Œåˆ›å»ºæ„é€ å‡½æ•°
â”‚ â”œâ”€â”€ defaults.js              # é»˜è®¤é…ç½®
â”‚ â””â”€â”€ utils.js                 # å…¬ç”¨å·¥å…·
```



## axiosçš„è¿è¡Œæµç¨‹

æˆ‘é˜…è¯»å®Œæˆæºç åï¼Œæ¢³ç†äº†ä¸€ä¸‹è¿è¡Œæ€è·¯ï¼Œaxioså¤§è‡´åˆ†ä¸º **å››ä¸ªé˜¶æ®µ**

1. åˆå§‹åŒ–å‚æ•°
2. åˆå§‹åŒ–æ‹¦æˆªå™¨ï¼Œæ·»åŠ åŸå‹é“¾æ–¹æ³•
3. åˆå¹¶åŸå‹é“¾å¯¹è±¡åˆ°axiosï¼Œä¾¿äºç›´æ¥è°ƒç”¨
4. å¼€å§‹è¿›è¡Œè¯·æ±‚(æœ‰æ‹¦æˆªå™¨æ‰§è¡Œæ‹¦æˆªå™¨)



ä¸‹é¢å°†ç»“åˆä»£ç ä»¥åŠå›¾ç‰‡è¿›è¡Œaxioså†…éƒ¨å®ç°è¿‡ç¨‹çš„æ¢³ç†



å½“æˆ‘ä»¬å¼€å§‹ä½¿ç”¨axiosçš„æ—¶å€™ï¼Œä¾‹å¦‚

```js
let axios = require('./lib/axios')

axios('https://www.easy-mock.com/mock/.....')
  .then(res => {
    // .....
  })
  .catch(res => {
    // .....
  })

```

ä½¿ç”¨äº†`./lib/axios`å¯¼å‡ºçš„axioså¯¹è±¡ï¼Œæ¯«æ— ç–‘é—®è¿™æ˜¯axiosçš„å…¥å£æ–‡ä»¶

## åˆå§‹åŒ–å‚æ•°

**lib/axios**

> ä¸ºäº†ä¾¿äºæŸ¥çœ‹ï¼Œæˆ‘åˆ é™¤äº†ä¸€äº›axioså…¶ä»–æ–¹æ³•çš„ä»£ç 

````js
'use strict'

var utils = require('./utils')
var bind = require('./helpers/bind')
var Axios = require('./core/Axios')
var mergeConfig = require('./core/mergeConfig')
var defaults = require('./defaults')

/**
 * åˆ›å»ºAxioså®ä¾‹
 *
 * @param {Object} defaultConfigå®ä¾‹çš„é»˜è®¤é…ç½®
 * @return {Axios} Axiosçš„æ–°å®ä¾‹
 */
function createInstance(defaultConfig) { // (2)
  // defaultConfig ä¸ºåˆå§‹åŒ–é…ç½®
  var context = new Axios(defaultConfig);

  // bind(Axios.prototype.requestï¼Œ context)çš„ç›®çš„æ˜¯è®©axiosé»˜è®¤åŠrequestæ–¹æ³•
  var instance = bind(Axios.prototype.requestï¼Œ context)
  
  // å°†Axios.prototypeçš„åŸå‹é“¾ä¸Šçš„å¯¹è±¡å¤åˆ¶åˆ°instanceä¸Šé¢
  utils.extend(instanceï¼Œ Axios.prototypeï¼Œ context);
    
  // å°†æ‹¦æˆªå™¨ï¼Œé»˜è®¤é…ç½®å¤åˆ¶åˆ°instance(è¿™é‡Œä¸»è¦æ˜¯æ‹¦æˆªå™¨æ“ä½œ)
  utils.extend(instanceï¼Œ context)
    
  return instance
}

// åˆ›å»ºè¦å¯¼å‡ºçš„é»˜è®¤å®ä¾‹
// å½“axiosæ‰§è¡Œçš„æ—¶å€™ é¦–å…ˆaxiosè¿›è¡Œé»˜è®¤çš„åˆå§‹åŒ–é…ç½®
var axios = createInstance(defaults) // (1)

module.exports = axios

// å…è®¸åœ¨TypeScriptä¸­ä½¿ç”¨é»˜è®¤å¯¼å…¥è¯­æ³•
module.exports.default = axios
````



è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œå½“æˆ‘ä»¬æ‰§è¡Œ`axios`çš„æ—¶å€™ï¼Œ`axios =createInstance(defaults)`ï¼Œä¹Ÿå°±æ˜¯è¯´ `axios`æ˜¯`createInstance()`

äºæ˜¯æ‰§è¡Œ`createInstance(defaults)` `default`æ˜¯å…¶ä»–æ–‡ä»¶å¼•å…¥ï¼Œç”¨äºå‚æ•°åˆå§‹åŒ–

> å› ä¸ºdefaultçš„ä»£ç å¾ˆé•¿ï¼Œè¿™é‡Œå°±ä¸è´´äº†ï¼Œè¿™é‡Œè¯´æ˜åˆå§‹åŒ–éƒ½åšäº†ä»€ä¹ˆ

åœ¨`lib/default.js`

1. åˆ¤æ–­å½“å‰æ˜¯æµè§ˆå™¨ç¯å¢ƒè¿˜æ˜¯`node`ç¯å¢ƒï¼Œåˆ†åˆ«ä½¿ç”¨`xhr`ä¸ `http`
2. æ·»åŠ é»˜è®¤é…ç½®ï¼Œä¾‹å¦‚`header` `itemout`
3. å¸®åŠ©æˆ‘ä»¬é»˜è®¤æ·»åŠ `xsrfCookieName`ï¼Œç”¨äºé˜²æ­¢`asrf`æ”»å‡»
4. ç­‰ç­‰å¾ˆå¤šåˆå§‹åŒ–å‚æ•°

##### å®Œæˆåˆå§‹åŒ–

![img](http://www.vkcyan.top/FiAhMcl7leBqc_BseYHRpkT3ts3J.png)



## åˆå§‹åŒ–æ‹¦æˆªå™¨ï¼Œæ·»åŠ åŸå‹é“¾æ–¹æ³•

å½“å‚æ•°åˆå§‹åŒ–å®Œæˆåï¼Œè¢«ä½œä¸ºå‚æ•°ä¼ é€’åˆ°`createInstance()`

```
// defaultConfig ä¸ºåˆå§‹åŒ–é…ç½®
var context = new Axios(defaultConfig)
```

æ‰§è¡Œäº†`./lib/core/Axios.js`

### åˆå§‹åŒ–æ‹¦æˆªå™¨

```js
// ...... å¯¼å…¥åº“

/**
 * åˆ›å»ºAxiosçš„æ–°å®ä¾‹
 *
 * @param {Object} instanceConfigå®ä¾‹çš„é»˜è®¤é…ç½®
 */
function Axios(instanceConfig) {
  // eslint-disable-next-line no-console
  this.defaults = instanceConfig // å°†åˆå§‹åŒ–çš„å‚æ•°æŒ‚è½½åˆ°thisä¸Š ä¾¿äºåŸå‹çš„è®¿é—®
  this.interceptors = {
    request: new InterceptorManager()ï¼Œ
    response: new InterceptorManager()
  }
}

// ...... ç­‰ç­‰åŸå‹é“¾ä»£ç 
```

è¿™é‡Œï¼Œå¯ä»¥çœ‹åˆ°`this.interceptors `ï¼Œæ˜¯ä¸æ˜¯å¾ˆçœ¼ç†Ÿ?è¿™æ˜¯æˆ‘ä»¬ä½¿ç”¨çš„æ‹¦æˆªå™¨å¯¹è±¡

æ‰€ä»¥éœ€è¦çœ‹çœ‹ï¼Œåˆå§‹åŒ–çš„æ—¶å€™ï¼Œæ‹¦æˆªå™¨å†…éƒ¨æ˜¯ä»€ä¹ˆ

`./lib/core/InterceptorManager`

```js
'use strict';

var utils = require('./../utils');

function InterceptorManager() {
  this.handlers = [];
}

InterceptorManager.prototype.use = function use(fulfilledï¼Œ rejected) {
  this.handlers.push({
    fulfilled: fulfilledï¼Œ
    rejected: rejected
  });
  // è¿™é‡Œè¿”å›æ²¡é—®é¢˜ ä½†æ˜¯ä¸ºä»€ä¹ˆè¿™ä¹ˆå†™?
  return this.handlers.length - 1;
};


InterceptorManager.prototype.eject = function eject(id) {
  if (this.handlers[id]) {
    this.handlers[id] = null;
  }
};

// è¿­ä»£æ‰€æœ‰å·²æ³¨å†Œçš„æ‹¦æˆªå™¨
InterceptorManager.prototype.forEach = function forEach(fn) {
  // fn > function
  utils.forEach(this.handlersï¼Œ function forEachHandler(h) {
    if (h !== null) {
      // å°†æ‹¦æˆªå™¨é‡Œé¢çš„å‡½æ•°äº¤ç»™å…¶å›è°ƒ
      fn(h);
    }
  });
};

module.exports = InterceptorManager;

```

ä¼¼ä¹ç®€å•çš„å‡ºä¹æ„æ–™ï¼Œä»…ä»…æ˜¯åˆå§‹åŒ–äº†ä¸€ä¸ªæ•°ç»„ï¼Œæä¾›äº†`use(pushæ•°ç»„)` `eject(æ¸…ç©ºæ•°ç»„)` `forEach`ä¸‰ä¸ªæ–¹æ³•

new Axioså®Œæˆå(åŸå‹æ–¹æ³•è¿˜æ²¡æœ‰æŒ‚è½½å‰)

![](http://www.vkcyan.top/FoaUkQVyyYVhsLEOwdwUOB_vwIQt.png)

æ‹¦æˆªå™¨åˆå§‹åŒ–å®Œæˆäº†

### åˆå§‹åŒ–åŸå‹æ–¹æ³•

> è¿™é‡Œæ˜¯axioså®ç°çš„æ ¸å¿ƒ

`./lib/core/Axios.js`

```js
// ...... new Axios().... 



/**
 * å‘é€è¯·æ±‚æ–¹æ³•
 *
 * @param {Object} config The config specific for this request (merged with this.defaults)
 */
// å½“æˆ‘ä»¬è¯·æ±‚`axios.request(//...) å‚æ•°å°±ä¼šAxios.prototype.requestæ¥æ”¶        
Axios.prototype.request = function request(config) {
  /*eslint no-param-reassign:0*/
  // ä½œè€…ä¸ºæˆ‘ä»¬æä¾›axios('url'ï¼Œ{})ä»¥åŠaxios(config)ä¸¤ç§å†™æ³•
  if (typeof config === 'string') {
    config = arguments[1] || {} 
    config.url = arguments[0]
  } else {
    config = config || {}
  }
  // åˆå¹¶ defaultconfigä¸è‡ªå®šä¹‰çš„config
  config = mergeConfig(this.defaultsï¼Œ config)
  config.method = config.method ? config.method.toLowerCase() : 'get' // é»˜è®¤æ²¡æœ‰éƒ½æ˜¯getè¯·æ±‚

  // åˆ›é€ ä¸€ä¸ªè¯·æ±‚åºåˆ—æ•°ç»„ ç¬¬ä¸€ä½æ˜¯å‘é€è¯·æ±‚çš„æ–¹æ³•ï¼Œç¬¬äºŒä½æ˜¯ç©º
  var chain = [dispatchRequestï¼Œ undefined]
  var promise = Promise.resolve(config) // åˆ›å»ºä¸€ä¸ªpromiseå¯¹è±¡ï¼Œå¹¶æŠŠå‚æ•°ä¼ é€’è¿›å»
  //this.interceptors.request = InterceptorManager() å¦‚æœå®šä¹‰æ‹¦æˆªå™¨ é‚£ä¹ˆ è¿™é‡Œçš„InterceptorManagerå†…éƒ¨çš„handlerså°±ä¼šå­˜åœ¨ä½ å†™çš„æ‹¦æˆªå™¨ä»£ç 
  // æ‰§è¡ŒInterceptorManageråŸå‹é“¾ä¸Šçš„forEachäº‹ä»¶
  this.interceptors.request.forEach(function unshiftRequestInterceptors(
    interceptor
  ) {
    // interceptor ä¸º æ‰§è¡ŒInterceptorManageråŸå‹é“¾ä¸Šçš„forEachäº‹ä»¶è¿”å›çš„ æ‹¦æˆªå™¨å‡½æ•°
    //æŠŠè¯·æ±‚æ‹¦æˆªå™¨æ•°ç»„ä¾ä»åŠ å…¥å¤´éƒ¨
    chain.unshift(interceptor.fulfilledï¼Œ interceptor.rejected)
  })

  this.interceptors.response.forEach(function pushResponseInterceptors(
    interceptor
  ) {
    // åŒç†
    // å°†æ¥æ”¶æ‹¦æˆªå™¨æ•°ç»„ä¸€æ¬¡åŠ å…¥å°¾éƒ¨
    chain.push(interceptor.fulfilledï¼Œ interceptor.rejected)
  })

  while (chain.length) {
    // shift() æ–¹æ³•ç”¨äºæŠŠæ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä»å…¶ä¸­åˆ é™¤ï¼Œå¹¶è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ çš„å€¼ã€‚
    // å½¢æˆä¸€ä¸ªpromiseè°ƒç”¨é“¾æ¡
    promise = promise.then(chain.shift()ï¼Œ chain.shift())
  }
  return promise
}

Axios.prototype.getUri = function getUri(config) {
  config = mergeConfig(this.defaultsï¼Œ config)
  return buildURL(config.urlï¼Œ config.paramsï¼Œ config.paramsSerializer).replace(
    /^\?/ï¼Œ
    ''
  )
}

// ä¸ºæ”¯æŒçš„è¯·æ±‚æ–¹æ³•æä¾›åˆ«å
utils.forEach(
  ['delete'ï¼Œ 'get'ï¼Œ 'head'ï¼Œ 'options']ï¼Œ
  function forEachMethodNoData(method) {
    /*eslint func-names:0*/
    // è¿™é‡Œæä¾›äº†è¯­æ³•é€šï¼Œåœ¨axiosçš„åŸå‹é“¾æ¡ä¸Šé¢ å¢åŠ 'delete'ï¼Œ 'get'ï¼Œ 'head'ï¼Œ 'options'ç›´æ¥è°ƒç”¨çš„æ–¹æ³• å®é™…ä¸Šè¿˜æ˜¯request
    Axios.prototype[method] = function(urlï¼Œ config) {
      return this.request(
        utils.merge(config || {}ï¼Œ {
          method: methodï¼Œ
          url: url
        })
      )
    }
  }
)

// ä¸ä¸Šæ–¹åŒç†
utils.forEach(['post'ï¼Œ 'put'ï¼Œ 'patch']ï¼Œ function forEachMethodWithData(method) {
  /*eslint func-names:0*/
  Axios.prototype[method] = function(urlï¼Œ dataï¼Œ config) {
    return this.request(
      utils.merge(config || {}ï¼Œ {
        method: methodï¼Œ
        url: urlï¼Œ
        data: data
      })
    )
  }
})

module.exports = Axios
```

è¿™é‡Œçš„ä»£ç ï¼Œæ¯”è¾ƒæ™¦æ¶©éš¾æ‡‚ï¼Œä½†æ˜¯å®ç°çš„éå¸¸å·§å¦™ï¼Œæˆ‘ç”¨ä»¥ä¸‹æ–‡å›¾æ¥è¡¨è¾¾



å½“æˆ‘ä»¬æ‰§è¡Œä»¥ä¸‹ä»£ç 

```js
let axios = require('./lib/axios')
axios.interceptors.request.use(
  function(config) {
    console.log(config);
    return config
  }ï¼Œ
  function(error) {
    return Promise.reject(error)
  }
)
axios.interceptors.response.use(
  function(res) {
    console.log(res);
    return res
  }ï¼Œ
  function(error) {
    console.log(error);
  }
)

console.log('è¯·æ±‚å¼€å§‹å‰çš„å‡†å¤‡ä¸ªå·¥ä½œ');
axios.get('......')
  .then(res => {
    console.log(res)

  })
  .catch(res => {
    console.log(res)
  }) 
```

![](http://www.vkcyan.top/FkYrFRVTFzKtYrh3HxyBHPQB6zaY.png)



è¿™é‡Œç”±è¯·æ±‚åºåˆ—æ•°ç»„å®ç°çš„`promise`æ‰§è¡Œé“¾æ¡ï¼Œå¸®åŠ©æˆ‘ä»¬å®ç°äº†`æ‹¦æˆªå™¨`ç­‰åŠŸèƒ½

å€Ÿç”¨çŸ¥ä¹[ç†µä¸å•å­çš„ä»£ç æœ¬](https://zhuanlan.zhihu.com/c_90568250)å¤§ä½¬çš„å›¾ç¤º(æˆ‘è§‰å¾—ç®€å•æ˜äº†)

 ![](https://pic3.zhimg.com/80/v2-3445b621a1e8214b0b3816ddcabfab86_hd.png)



å†æ¬¡å¼•ç”¨[ç†µä¸å•å­çš„ä»£ç æœ¬](https://zhuanlan.zhihu.com/c_90568250)çš„[ã€æºç æ‹¾é—ã€‘axios â€”â€” æç®€å°è£…çš„è‰ºæœ¯](https://zhuanlan.zhihu.com/p/28396592)çš„ä¸€å¥è¯

```
é€šè¿‡å·§å¦™çš„åˆ©ç”¨unshiftã€pushã€shiftç­‰æ•°ç»„é˜Ÿåˆ—ã€æ ˆæ–¹æ³•ï¼Œå®ç°äº†è¯·æ±‚æ‹¦æˆªã€æ‰§è¡Œè¯·æ±‚ã€å“åº”æ‹¦æˆªçš„æµç¨‹è®¾å®šï¼Œæ³¨æ„æ— è®ºæ˜¯è¯·æ±‚æ‹¦æˆªè¿˜æ˜¯å“åº”æ‹¦æˆªï¼Œè¶Šå…ˆæ·»åŠ çš„æ‹¦æˆªå™¨æ€»æ˜¯è¶Šâ€œè´´è¿‘â€æ‰§è¡Œè¯·æ±‚æœ¬èº«ã€‚
```





## å¯¹åŸå‹é“¾ä¸Šçš„æ–¹æ³•çš„å¤„ç†

ä¸çŸ¥ é“ç›®å‰ä¸ºæ­¢ çœ‹èµ·æ¥ä¼¼ä¹ä¸€èµ·å˜çš„æ¯”è¾ƒæ˜äº†ï¼Œä½†æ˜¯è¿˜å­˜åœ¨ä¸€äº›é—®é¢˜

> request get post ç­‰ç­‰æ–¹æ³•éƒ½åœ¨Axios.prototypeä¸Šé¢ï¼Œä¹Ÿå°±æ˜¯è¯´ç›®å‰ä¸ºæ­¢è¿˜æ— æ³•ç›´æ¥è°ƒç”¨åŸå‹é“¾ä¸Šçš„æ–¹æ³•

äºæ˜¯æˆ‘ä»¬çœ‹**./lib/axios.js**çš„ `createInstance(defaultConfig) `åé¢è¿˜æ²¡æœ‰çœ‹çš„ä»£ç 

```JavaScript
function createInstance(defaultConfig) {
  console.log(defaultConfig);
  
  // defaultConfig ä¸ºåˆå§‹åŒ–é…ç½®
  var context = new Axios(defaultConfig)
  // å°†Axios.prototype.requestçš„thisä¼ é€’ç»™context
  // bind(Axios.prototype.requestï¼Œ context)çš„ç›®çš„æ˜¯è®©axiosé»˜è®¤åŠrequestæ–¹æ³•
  var instance = bind(Axios.prototype.requestï¼Œ context)
  // var instance = context
  // å°†Axios.prototypeçš„åŸå‹é“¾ä¸Šçš„å¯¹è±¡å¤åˆ¶åˆ°instanceä¸Šé¢
  utils.extend(instanceï¼Œ Axios.prototype)
  // utils.extend(instanceï¼Œ Axios.prototypeï¼Œ context)
  // å°†æ‹¦æˆªå™¨ï¼Œé»˜è®¤é…ç½®å¤åˆ¶åˆ°instance(è¿™é‡Œä¸»è¦æ˜¯æ‹¦æˆªå™¨æ“ä½œ)
  utils.extend(instanceï¼Œ context)
  return instance
}
```

ç€é‡çœ‹è¿™å‡ è¡Œ

```JavaScript
  var instance = bind(Axios.prototype.requestï¼Œ context)
  utils.extend(instanceï¼Œ Axios.prototypeï¼Œ context)
  utils.extend(instanceï¼Œ context)

  return instance
```

è¿™é‡Œç”¨åˆ°äº†`bind`ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜è¦çœ‹çœ‹bind

```js
module.exports = function bind(fnï¼Œ thisArg) {
  return function wrap() {
    // è·å–åˆ°axios(//...)é‡Œé¢çš„å‚æ•°
    var args = new Array(arguments.length)
    for (var i = 0; i < args.length; i++) {
      args[i] = arguments[i]
    }
    // å°†fnçš„thisä¼ é€’ç»™thisArg ä¾‹å¦‚å°†axios('www.baidu.com') å°±ä¼šæ‰§è¡Œè¿™ä¸ªwarpå‡½æ•°æœ€åå°†å‚æ•°äº¤ç»™fnä¹Ÿå°±æ˜¯Axios.prototype.request
    return fn.apply(thisArgï¼Œ args)
  }
}
```

æ˜æ˜¾çœ‹å‡º ç»è¿‡å¤„ç†çš„`instance`æ˜¯ä¸€ä¸ªå¯¹è±¡

å½“æˆ‘ä»¬ä½¿ç”¨

```
axios('// .... è¯·æ±‚è¿æ¥')
```

å°±æ˜¯æ‰§è¡Œ`wrap()`ï¼Œå°†å‚æ•°ï¼Œå…¨éƒ¨`apply`åˆ°fnä¸Šï¼Œä¹Ÿå°±æ˜¯`Axios.prototype.request`ä¸Šï¼Œè¿™æ ·çš„thisæŒ‡å‘çš„è°ƒæ¢ï¼Œå³é»˜è®¤

```
axios('//....') === Axios.prototype.request('//....')
```

åé¢çš„extendï¼Œå¸®åŠ©æˆ‘ä»¬å°†å…¶ä»–Axiosçš„åŸå‹å±æ€§`get` `post` ç­‰ç­‰ï¼Œç§»æ¤åˆ°è¿”å›å‡ºå»çš„`instance`ä¸Šé¢

```
axios.get('//....') === Axios.prototype.get('//....')
```

å¦åˆ™æˆ‘ä»¬æ— æ³•é€šè¿‡`axios.get()` `axios.post`è¿›è¡Œè°ƒç”¨

```js
/**
 * ä¸ºå¯¹è±¡aæ‹“å±•å¯¹è±¡bçš„å±æ€§
 *
 * @param {Object} a éœ€è¦æ‹“å±•çš„å±æ€§
 * @param {Object} b è¦ä»ä¸­å¤åˆ¶å±æ€§çš„å¯¹è±¡
 * @param {Object} thisArg è¦ç»‘å®šå‡½æ•°çš„å¯¹è±¡
 * @return {Object} The è¿”å›å€¼
 */
function extend(aï¼Œ bï¼Œ thisArg) {
  console.log(b);
  forEach(bï¼Œ function assignValue(valï¼Œ key) {
    if (thisArg && typeof val === 'function') {
      a[key] = bind(valï¼Œ thisArg); // ä¸€èˆ¬æƒ…å†µä¸‹ å’Œ else æ•ˆæœ æˆ‘ä¸æ˜¯å¾ˆæ˜ç™½è¿™é‡Œbindçš„å¿…è¦æ€§
    } else {
      a[key] = val; // å°†bçš„å±æ€§ç§»æ¤åˆ° aä¸Š
    }
  });
  return a;
}
```

æœ€åè¿”å›å‡ºå»çš„`instance`ï¼Œå°±æ˜¯æˆ‘ä»¬æ—¥å¸¸ä½¿ç”¨çš„axiosäº† ğŸ˜ƒ



## è¯·æ±‚æµç¨‹

æœ€åæ ¹æ®ä¸Šé¢çš„æ€»ç»“ï¼Œæ¢³ç†ä¸€ä¸‹axiosçš„è¯·æ±‚è¿‡ç¨‹

![](http://www.vkcyan.top/Fm6-VsddRCNRQUkNaA90OwVnZR66.png)

## æ€»ç»“

â€‹	æœ€è¿‘ä¸æ˜¯å¾ˆå¿™ï¼Œæ‰€ä»¥æŠ½å‡ºæ—¶é—´ï¼ŒæŸ¥çœ‹äº†axoisçš„æºç ï¼Œæœ¬æ–‡ä»…ä»…å¾ˆç²—ç•¥çš„ç†äº†axiosçš„æ‰§è¡Œè¿‡ç¨‹ï¼Œä»¥åŠå†…éƒ¨çš„ä¸€äº›å®ç°æ€è·¯ï¼Œå®é™…ä¸Šaxiosæºç çš„å†…å®¹éå¸¸ä¸°å¯Œï¼Œä¹Ÿè¿˜æœ‰å¾ˆå¤šæ¨¡å—æ²¡æœ‰è¯´ï¼Œä¾‹å¦‚ **adapter** **dispatchRequest**ï¼Œ**å–æ¶ˆè¯·æ±‚**ï¼Œç­‰ç­‰ï¼Œè¿˜æœ‰å¾ˆå¤š **å·¥å…·å‡½æ•°** å€¼å¾—æˆ‘ä»¬å­¦ä¹ 



â€‹	å¯èƒ½æœ‰äº›å¼€å‘è€…ä¹Ÿæœ‰æƒ³å»è¯»æºç çš„å¿ƒæƒ…ï¼Œä½†æ˜¯å¾ˆå¤šåº“æ–‡ä»¶ä¹‹é—´**ä¾èµ–å…³ç³»å¤æ‚**ï¼Œä»…ä»…å»è¯» æ˜¯å¾ˆéš¾è¯»æ‡‚çš„ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦æŠŠæºç è¿è¡Œèµ·æ¥ï¼Œåœ¨å…³é”®åœ°æ–¹`debugger`ä»¥åŠæ·»åŠ `log`æ›´åŠ å®¹æ˜“ç†æ¸…æ€è·¯.é‚£ä¹ˆå»cloneæˆ‘çš„[æ­å»ºes6è°ƒè¯•ç¯å¢ƒ](https://github.com/vkcyan/text/blob/master/JavaScript/webpack%E6%90%AD%E5%BB%BAes6%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83.md)ï¼Œè¿›è¡Œaxiosæºç çš„é˜…è¯»



â€‹	ç›¸å…³æ–‡ç« å·²ç»æœ‰å¾ˆå¤šå¤§ä½¬è§£è¯»ï¼Œæœ¬ç¯‡æ–‡ç« ä¸ºä¸ªäººæ€»ç»“ï¼Œï¼Œå¦‚æœ‰é”™è¯¯ï¼Œæˆ–è€…æ­§ä¹‰ æ¬¢è¿æå‡º æ¬¢è¿äº¤æµğŸ™ˆğŸ™ˆğŸ™ˆ