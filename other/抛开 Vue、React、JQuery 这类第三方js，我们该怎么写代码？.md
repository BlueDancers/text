# 抛开 Vue、React、JQuery 这类第三方js，我们该怎么写代码？

原创作者: 亚里士朱德

文章链接:https://mp.weixin.qq.com/s/B5Nl7vee9yWdcd_oxn0bXQ


*首先感谢React、Vue、Angular、Cycle、JQuery 等这些第三方js为开发带来的便利。*

> 以下将Vue、React这类常用的框架（库）统称为“第三方js”。

# 第三方js的现状

无论是新入行的小白还是有经验的开发者，前端圈里的人一定听过这类第三方js的大名。
一方面是因为它们实在太火了：

- 各种文章对框架进行对比、源码解析以。
- GitHub 上 star 数量高速增长。
- 各种针对框架的培训课程层出不穷。
- ……

另一方面是因为用它们开发非常方便：

- 利用脚手架工具几行命令就可以快速搭建项目。
- 减少大量的重复代码，结构更加清晰，可读性强。
- 有丰富的UI库和插件库。
- ……

但是一则 GitHub 放弃使用 JQuery 的消息让我开始思考：

**第三方js除了带来便利之外还有哪些副作用？**
**抛弃第三方js我们还能写出高效的代码吗？**

# 第三方js的副作用

## 雪球滚起来

如果现在让你开发一个项目，你会怎么做？
假设你熟悉的是React，那么用可以用`create-react-app`快速搭建一个项目。

- 很好，react、react-dom、react-router-dom 已经写入了package.json，不过事情还没完。
- http请求怎么处理呢？引入axios吧。
- 日期怎么处理？引入 moment 或 day 吧。
- ……

要知道，这种“拿来主义”是会“上瘾”的，所以第三方依赖就像一个滚动的雪球，随着开发不断增加，最后所占体积越来越大。
如果用 `webpack-bundle-analyzer` 工具来分析项目的话，会发现项目代码大部分体积都在`node_modules`目录中，也就意味着都是第三方js，典型的二八定律（80%的源代码只占了编译后体积的20%）。

![](https://s1.ax2x.com/2018/11/16/5zcndK.png)

于是不得不开始优化，比如治标不治本的`code split`（代码体积并没有减小，只是拆分了），比如万试万难灵的`tree shaking`（你确定shaking之后的代码都只有你真正依赖的代码？），优化效果有限不说，更糟糕的是依赖的捆绑。
比如`ant-design`的模块的日期组件依赖了`moment`，那我们在使用它的时候`moment`就被引入了。
而且我即使发现体积更小的`dayjs`可以基本取代`moment`的功能，也不敢引入，因为替换它日期组件会出问题，同时引入又增加了项目体积。

有些第三方js被合称之为“全家桶”，这种叫法让我想起了现在PC端的一些工具软件，本来你只想装一个电脑管家，结果它不断弹窗提示你电脑不安全，建议你安装一个杀毒软件，又提示你软件很久没更新，提示你安装某某软件管家…..
本来只想装一个，结果装了全家。

## 工具驯化

如果你注意观察，在这些第三方js的使用者中，会看到这样一些现象：

- **排他**。一些使用 MV* 框架的开发者很喜欢站队进行讨论，比如喜欢用 VueJS 的开发者很可能会吐槽 ReactJS，喜欢 Angular 的开发者会喷 VueJS。
- **浮躁**。一些经验并不丰富的开发者会觉得：使用JavaScript操作DOM多么低效，直接来个第三方js双向数据绑定好了。自己写XMLHTTPRequest发送请求多么麻烦，来第三方js直接调用好了。
- **局限**。一些面试者以为自己熟悉某种第三方js之后就觉得自己技术不错（甚至很多时候这种“熟悉”还要打上引号），大有掌握了某种第三方js就掌握了前端之意。

这些第三方js本来是为了提升开发效率的工具，却不知不觉地把开发者驯化了，让其产生了依赖。
如果每次让你开发新项目，你不得不依赖第三方js提供的脚手架来搭建项目，然后才能开始写代码。
那么很可能你已经形成工具思维，就像手里拿着锤子，是什么都是钉子，你处理问答的方式，看问题的角度很可能会受此局限。
同时也意味着你正在离底层原生编码越来越远，越不熟悉原生API，你就越只能依赖第三方js，如此循环往复。

**怎么打破这种状况？**
先推荐张鑫旭的一篇文章[《不破不立的哲学与个人成长》](https://www.zhangxinxu.com/life/2018/08/%E4%B8%8D%E7%A0%B4%E4%B8%8D%E7%AB%8B-%E4%B8%AA%E4%BA%BA%E6%88%90%E9%95%BF/)
这里需要注意的是，我所说的放弃并不是所有项目都自己写框架，这样在效率上而言是做不到的。
更推荐的而是在一些时间相对充裕、影响（规模）不大的项目中进行尝试。
比如开发某个公司内部使用的小工具，或者页面数量不多的时间不紧张（看个人开发速度）的小项目。

用原生API进行开发的时候我们可以参考下面两条建议。



## 理解精髓

虽然我们不使用任何第三方js，但是其原理及实现我们是可以学习，比如你知道实现数据绑定的方式有脏值检测、以及`Object.defineProperty`，那么你在写代码的时候就可以使用它们，你会发现懂这些原理和真正使用起来还有不小的距离。
换个角度而言，这也可以进一步加深我们对第三方js的理解。

当然我们的目的并不是为了再造一个山寨版的js，而是适当地结合、删减和优化已有的技术和思想，为业务定制最合适的代码。

文中提到的第三方js受欢迎很重要的一个原因是因为对DOM操作进行了优化甚至是隐藏。
JQuery号称是DOM操作的利器，将DOM封装成JQ对象并扩展了API，而MV*框架取代JQuery的原因是因为在DOM操作这条路上做得更绝，直接屏蔽了底层操作，将数据映射到模板上。如果这些MV*的思考方式还只是停留在DOM的层次上的话估计也无法发展到今天的规模。
因为屏蔽DOM只是简化了代码而已，要搭建大型项目还要考虑代码组织的问题，就是抽象和复用。
这些第三方js选择的方式就是“组件化”，把HTML、js和CSS封装在一个具有独立作用域的组件中，形成可复用的代码单元。

# 无依赖实践

// .....

